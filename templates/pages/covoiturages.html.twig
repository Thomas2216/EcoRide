{% extends 'base.html.twig' %}

{% block body %}

<h2 class="covoiturages-title">Acc√®s aux covoiturages</h2>

<div>
    <p class="covoiturages-description">
        Bienvenue sur la page des covoiturages. Ici, vous pouvez rechercher et r√©server des trajets partag√©s avec d'autres utilisateurs.
    </p>
</div>

{% if covoiturages|length %}
    <div class="d-flex flex-wrap justify-content-center">
        {% for covoiturage in covoiturages %}
            <div class="card-list">
                <div class="card">
                    <div class="card-header">
                        D√©part : {{ covoiturage.lieuDepart }} <br>
                        Arriv√©e : {{ covoiturage.lieuArrivee }}
                    </div>

                    <div class="card-body">

                        <h5 class="card-title">Date : {{ covoiturage.dateDepart|date('d/m/Y') }}</h5>
                        <h5 class="card-title">Heure de d√©part : {{ covoiturage.heureDepart|date('H:i') }}</h5>
                        <h5 class="card-title">Arriv√©e estim√©e : {{ covoiturage.heureArrivee|date('H:i') }}</h5>

                        <p class="card-text">Places disponibles : {{ covoiturage.nbPlace }}</p>
                        <p class="card-text">Prix : {{ covoiturage.prixPersonne }} ‚Ç¨</p>

                        <hr>

                        <p class="card-text">
                            üë§ Conducteur :
                            {{ covoiturage.conducteur.prenom }} {{ covoiturage.conducteur.nom }}
                        </p>

                        <p class="card-text">
                            üöó V√©hicule :
                            {% if covoiturage.voiture %}
                                {{ covoiturage.voiture.marque }} {{ covoiturage.voiture.modele }}
                            {% else %}
                                <em>Aucune voiture associ√©e</em>
                            {% endif %}
                        </p>

                        <hr>

                        {# --- AJOUT DES AVIS DU CONDUCTEUR --- #}
                        <p class="card-text fw-bold">‚≠ê Avis sur le conducteur :</p>

                        {% set avisConducteur = covoiturage.conducteur.avis %}
                        
                        {% if avisConducteur|length > 0 %}

                            {# Note moyenne #}
                            {% set total = 0 %}
                            {% for avis in avisConducteur %}
                                {% set total = total + avis.note %}
                            {% endfor %}
                            {% set moyenne = (total / avisConducteur|length)|number_format(1) %}

                            <p class="card-text">
                                Note moyenne : <strong>{{ moyenne }}/5</strong> ‚≠ê
                            </p>

                            <ul>
                                {% for avis in avisConducteur %}
                                    <li>
                                        <strong>{{ avis.note }}/5</strong> ‚Äî {{ avis.commentaire ?: "Pas de commentaire" }}
                                    </li>
                                {% endfor %}
                            </ul>

                        {% else %}
                            <p><em>Aucun avis pour ce conducteur pour le moment.</em></p>
                        {% endif %}

                        <a href="#"
                            class="btn btn-primary"
                            style="background-color: burlywood; color: #198754; border-color: #198754;">
                            R√©server ce covoiturage
                        </a>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
{% else %}
    <p class="text-center mt-4">Aucun covoiturage disponible pour le moment.</p>
{% endif %}

<div class="text-center mt-5">
    <a href="{{ path('app_saisir_covoiturage') }}"
        class="button-saisie-voyage"
        style="color: #198754; border-color: #198754;">
        Saisir un covoiturage
    </a>
</div>

{% endblock %}
